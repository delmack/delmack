{% extends "base.html" %}

{% block title %}Mapa de Imóveis - Baggio Portal{% endblock %}

{% block styles %}
    <!-- CSS do Leaflet (biblioteca do mapa) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <!-- CSS do MarkerCluster para agrupamento de marcadores -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />
{% endblock %}

{% block content %}
<header class="main-header">
    <h1>Mapa de Imóveis</h1>
</header>

<!-- Indicadores da API -->
<section class="indicators-grid" id="indicators-container">
    <div class="indicator-card"><h3>Total de Imóveis</h3><p class="indicator-value" id="total-imoveis">0</p></div>
    <div class="indicator-card"><h3>Para Venda</h3><p class="indicator-value" id="total-venda">0</p></div>
    <div class="indicator-card"><h3>Para Aluguel</h3><p class="indicator-value" id="total-aluguel">0</p></div>
    <div class="indicator-card"><h3>Tipos Diferentes</h3><p class="indicator-value" id="total-tipos">0</p></div>
</section>

<!-- Filtros -->
<section class="filters-section">
    <h3>Filtros do Mapa</h3>
    <div class="filters-container">
        <div class="filter-group">
            <label for="transactionFilter">Tipo de Transação:</label>
            <select id="transactionFilter" class="form-select">
                <option value="">Todos</option>
                <option value="SALE">Venda</option>
                <option value="RENT">Aluguel</option>
            </select>
        </div>
        <div class="filter-group">
            <label for="typeFilter">Tipo de Imóvel:</label>
            <select id="typeFilter" class="form-select">
                <option value="">Todos</option>
                <!-- Opções serão carregadas dinamicamente -->
            </select>
        </div>
        <button id="applyFilters" class="btn-apply-filters">Aplicar Filtros</button>
        <button id="clearFilters" class="btn-clear-filters">Limpar Filtros</button>
    </div>
</section>

<!-- Contêiner do Mapa -->
<section class="content-area">
    <div id="map">
        <div class="loading-spinner" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50% );"></div>
    </div>
</section>
{% endblock %}

{% block scripts %}
    <!-- JS do Leaflet e do MarkerCluster -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function ( ) {
            // Inicializa o mapa centrado em uma localização padrão (ex: Curitiba)
            const map = L.map('map').setView([-25.4284, -49.2733], 12);

            // Adiciona a camada de tiles do OpenStreetMap
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '© <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
            } ).addTo(map);

            // Mensagem de que a funcionalidade de dados está em desenvolvimento
            const mapContainer = document.getElementById('map');
            mapContainer.innerHTML = '<p style="text-align: center; padding: 50px; color: var(--text-secondary);">Carregamento de dados do mapa em desenvolvimento.</p>';

            // Aqui virá a lógica para buscar os dados da API e popular o mapa
            // Exemplo: fetch('/api/proxy/map-data').then(...)
        });
    </script>
{% endblock %}
